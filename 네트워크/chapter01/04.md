# 프로토콜 스택에 메시지 송신 의뢰

## 데이터 송-수신 동작의 개요

디지털 데이터를 송신하기 위해 프로토콜 스택에 의뢰한다.

OS 내부의 프로토콜 스택에 메시지 송신 동작을 의뢰할 때는  
Socket 라이브러리 프로그램 부품을 결정된 순번대로 호출한다.

1. 소켓을 만든다.
2. 서버측의 소켓에 파이프를 연결한다.
3. 데이터를 송-수신 한다.
4. 파이프를 분리하고 소켓을 말소한다.

애플리케이션과 프로토콜 스택 사이에는 Socket라이브러리의 중개가 있다.

</br>
</br>

## 소켓의 작성 단계

클라이언트 측의 소켓 : socket이라는 프로그램 부품을 호출하여 만든다.  
-> socket 내부로 제어가 넘어가서 소켓을 만드는 동작을 실행하고,  
애플리케이션으로 제어가 돌아옴

소켓이 생기면 디스크립터가 돌아온다.

```
디스크립터 : 소켓을 식별하기 위해 사용하는 것
```

</br>
</br>

## 파이프를 연결하는 접속 단계

connect라는 프로그램 부품을 호출해 서버측의 소켓에 접속하도록 프로토콜 스택에 의뢰함.  
-> 디스크립터, 서버의 IP주소, 포트 번호를 지정해 호출함.  
IP 주소와 포트 번호 두 가지를 지정해야 어느 컴퓨터의 어느 소켓과 접속할 지 분명히 지정할 수 있다.

서버측의 포트 번호는 애플리케이션에 미리 지정된 값을 사용한다.  
클라이언트측의 포트 번호는 일반적으로 소켓을 만들 때 프로토콜 스택이 적당한 값을 골라 할당한다.

</br>
</br>

## 메시지를 주고받는 송-수신 단계

애플리케이션이 송신 데이터를 메모리에 준비하고 write이라는 부품을 호출한다.  
-> 디스크립터와 송신 데이터를 지정한다.  
서버는 수신 동작을 실행해 받은 데이터의 내용을 조사하고 적절한 처리를 실행해 응답한다.

메시지를 수신 할 때는 read라는 프로그램 부품을 통해 프로토콜 스택에 수신 동작을 의뢰한다.

수신한 응답 메시지를 수신 버퍼에 저장한다.  
수신 메시지를 저장한 시점에서 메시지를 애플리케이션에 건네준다.

</br>
</br>

## 연결 끊기 단계에서 송-수신이 종료된다.

브라우저가 데이터 수신을 완료하면 close라는 프로그램 부품을 호출해 연결 끊기 단계로 들어가도록 의뢰한다.  
-> 소켓 사이를 연결한 파이프와 같은 것이 분리되고 소켓이 말소된다.

한개의 데이터를 읽을때마다 접속, 리퀘스트 메시지 송신, 응답 메시지 수신, 연결 끊기 동작을 반복한다.

HTTP 버전 1.1에서는 복수의 리퀘스트와 응답 주고받기를 실행하는 방법도 생겼다.
